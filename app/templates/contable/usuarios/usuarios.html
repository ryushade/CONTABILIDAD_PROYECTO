{% extends 'base.html' %}

{% block title %}Tormenta{% endblock %}



{% block content %}

<style>
    :root {
        --primary-color: #3b82f6;
        --secondary-color: #1e40af;
        --background-color: #f3f4f6;
        --text-color: #1f2937;
        --border-color: #e5e7eb;
        --hover-color: #eff6ff;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        line-height: 1.5;
        color: var(--text-color);
        margin: 0;
        padding: 0;
    }

    .sortable:hover {
        cursor: pointer;
    }


    /* Estilos responsivos */
    @media (max-width: 768px) {
        .table-scroll {
            min-width: 100%;
        }

        .acciones {
            min-width: auto;
        }

        .dropdown-menu {
            width: 100%;
        }
    }

    /* Estilos del modal */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .modal {
        background: white;
        padding: 20px;
        border-radius: 5px;
        width: 90%;
        max-width: 500px;
    }

    /* Estilos del dropdown */
    .dropdown-menu {
        width: 100%;
    }

    .dropdown-toggle::after {
        margin-left: .255em;
    }

    /* Estilos para alinear botones */
    .align-end {
        display: flex;
        justify-content: flex-end;
    }

    .table-scroll thead th {
        position: sticky;
        top: 0;
        z-index: 1;
    }

    .confirmation-modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1050;
    }

    .confirmation-modal {
        background: white;
        padding: 20px;
        border-radius: 8px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
        text-align: center;
    }
</style>
<div class="row align-items-center mt-4 mb-4">
    <div class="col-md-8">

        <h1 class="font-weight-bold display-8 text-left fs-3" style="font-weight: bold;">GESTIÓN DE USUARIOS</h1>
        <p class="fs-6 text-gray-500">Este apartado permite crear, editar y eliminar usuarios, asimismo, asignar
            permisos/roles.
        </p>
    </div>
    <div class="col-md-4 d-flex justify-content-end align-items-center mt-2 mt-md-0">
        <a class="btn btn-primary mb-2" style="margin-left: auto;" onclick="openModalAddUsu()">
            <i class="fa fa-plus" style="font-size: 14px;"></i> Agregar usuario
        </a>
    </div>
</div>
<div class="table-container mt-4">
    <div class="table-scroll">

        <table>
            <thead>
                <tr>
                    <th class="text-center" style="font-weight: bolder;">rol</th>
                    <th class="text-center" style="font-weight: bolder;">usuario</th>
                    <th class="text-center" style="font-weight: bolder;">contraseña</th>
                    <th class="text-center" style="font-weight: bolder;">estado</th>
                    <th class="text-center" style="font-weight: bolder;">ACCIONES</th>
                </tr>
            </thead>
            <tbody>
                {% for usuario in usuarios %}
                <tr>
                    <td class="text-center" style="padding: 20px;">{{ usuario.nom_rol }}</td>
                    <td class="text-center">{{ usuario.usua }}</td>
                    <td class="text-center">{{ usuario.contra }}</td>
                    <td class="text-center">
                        <span style="font-size: 14px;" class="
                status 
                {% if usuario.estado_usuario == 1 %}
                    active-c
                {% else %}
                    inactive
                {% endif %}
            ">
                            {% if usuario.estado_usuario == 1 %}
                            Activo
                            {% else %}
                            Inactivo
                            {% endif %}
                        </span>

                    </td>
                    <td class="text-center" style="font-size: 14px;">

                        <span style="font-size: 14px;" class="action-button secondary edit"
                            onclick="openEditUsu({{ usuario.id_usuario }})">
                            <i class="fas fa-edit"></i>
                        </span>

                        <span style="font-size: 14px;" class="action-button secondary trash"
                            onclick="openModalDeleteUsu('{{ usuario.id_usuario }}', '{{ usuario.usu }}')">
                            <i class="fas fa-trash"></i>
                        </span>


                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div id="addUsuarioModal" class="modal-overlay" style="display: none;">
    <div class="content-modal p-4 rounded" style="background-color: white; max-width: 600px; margin: auto;">
        <!-- Header -->
        <div class="modal-header">
            <h5 class="modal-title" style="font-size: 32px;">NUEVO USUARIO</h5>
            <button type="button" class="modal-close" onclick="closeModalUsu()"
                style="border: none; color: black; background-color: #e74c3c; font-weight: bold; font-size: 24px; width: 40px; height: 40px; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                &times;
            </button>
        </div>

        <!-- Body -->
        <div class="modal-body">
            <form onsubmit="submitAddUsuario(event)">
                <div class="row g-4">
                    <!-- Campo de Rol -->
                    <div class="col-md-6">
                        <label for="rol" class="form-label" style="font-weight: bold;">Rol:</label>
                        <select id="rol" name="rol" class="form-select">
                            <option selected>Seleccione...</option>
                            {% for rol in roles %}
                            <option value="{{ rol.id_rol }}">{{ rol.nom_rol }}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <!-- Campo de Usuario -->
                    <div class="col-md-6">
                        <label for="usuario" class="form-label" style="font-weight: bold;">Usuario:</label>
                        <input type="text" id="usuario" name="usuario" class="form-control"
                            placeholder="Ingrese usuario">
                    </div>

                    <!-- Campo de Contraseña -->
                    <div class="col-md-6">
                        <label for="contrasena" class="form-label" style="font-weight: bold;">Contraseña:</label>
                        <div class="input-group">
                            <input type="password" id="contrasena" name="contrasena" class="form-control"
                                placeholder="Ingrese contraseña">
                        </div>
                    </div>

                    <!-- Campo de Estado -->
                    <div class="col-md-6">
                        <label for="estado" class="form-label" style="font-weight: bold;">Estado:</label>
                        <select id="estado" name="estado" class="form-select">
                            <option selected>Seleccione...</option>
                            <option value="1">Activo</option>
                            <option value="0">Inactivo</option>
                        </select>
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="d-flex justify-content-end mt-4" style="gap: 10px;">
                    <button type="button" onclick="closeModalUsuE()" class="btn btn-secondary me-2">
                        <i class="fas fa-times"></i> Cerrar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<form method="POST" id="editUsuarioModal" class="edit-form" style="display: none;">
    <div class="modal-overlay">
        <div class="content-modal p-4 rounded" style="background-color: white; max-width: 600px; margin: auto;">
            <!-- Header -->
            <div class="modal-header">
                <h5 class="modal-title" style="font-size: 32px;">EDITAR USUARIO</h5>
                <button type="button" class="modal-close" onclick="closeModalUsuEdit()"
                    style="border: none; background: none;">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <!-- Body -->
            <div class="modal-body">
                <div class="row g-4">
                    <!-- Campo de Rol -->
                    <div class="col-md-6">
                        <label for="rol" class="form-label" style="font-weight: bold;">Rol:</label>
                        <select id="rol" name="rol" class="form-select">
                            <option value="ADMIN">Administrador</option>
                            <option value="EMPLEADO">Empleado</option>
                            <option value="Vendedor">Vendedor</option>
                            <option value="Contador">Contador</option>
                        </select>
                    </div>

                    <!-- Campo de Usuario -->
                    <div class="col-md-6">
                        <label for="usua" class="form-label" style="font-weight: bold;">Usuario:</label>
                        <input type="text" id="usua" name="usua" class="form-control" placeholder="Ingrese usuario">
                    </div>

                    <!-- Campo de Contraseña -->
                    <div class="col-md-6">
                        <label for="contrasena" class="form-label" style="font-weight: bold;">Contraseña:</label>
                        <div class="input-group">
                            <input type="password" id="contrasena" name="contrasena" class="form-control"
                                placeholder="Ingrese contraseña">
                        </div>
                    </div>

                    <!-- Campo de Estado -->
                    <div class="col-md-6">
                        <label for="estado" class="form-label" style="font-weight: bold;">Estado:</label>
                        <select id="estado" name="estado" class="form-select">
                            <option value="1">Activo</option>
                            <option value="0">Inactivo</option>
                        </select>
                    </div>
                </div>

                <!-- Botones de acción -->
                <div class="d-flex justify-content-end mt-4" style="gap: 10px;">
                    <button style="width: 122px; height: 45px;" type="button" onclick="closeModalUsuEdit()"
                        class="btn btn-secondary me-2">
                        <i style="height: 25px; width: 25px;" class="fas fa-times"></i> Cerrar
                    </button>
                    <button style="width: 122px; height: 45px;" type="submit" class="btn btn-primary">
                        <i style="height: 25px; width: 25px;" class="fas fa-save"></i> Guardar
                    </button>
                </div>
            </div>
        </div>
    </div>
</form>



<div id="deleteUsuarioModal" class="confirmation-modal-overlay" style="display: none;">
    <div class="confirmation-modal" style="text-align: center;">
        <div class="modal-icon" style="margin-bottom: 10px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                <line x1="12" y1="9" x2="12" y2="13"></line>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
        </div>
        <h2 class="confirmation-modal-title" style="color: rgb(30, 30, 30);">ELIMINAR USUARIO</h2>
        <p class="confirmation-modal-message">¿Estás seguro que deseas eliminar este usuario?</p>
        <input type="hidden" id="deleteUsuarioId" value="">
        <p id="deleteUsuarioInfo" class="confirmation-modal-message"
            style="font-size: 18px; color: rgb(30, 30, 30); font-weight: bold;">
        </p>
        <div class="confirmation-modal-buttons"
            style="gap: 14px; display: flex; justify-content: center; margin-top: 20px;">
            <button style="border-radius: 40px; width: 150px; height: 50px; font-weight: 600;" class="btn btn-secondary"
                onclick="closeModalDeleteUsuario()">No, Cancelar</button>
            <button style="border-radius: 40px; width: 150px; height: 50px; font-weight: 600;" class="btn btn-danger"
                onclick="deleteUsuario()">Sí, Eliminar!</button>
        </div>
    </div>
</div>

{% endblock %}